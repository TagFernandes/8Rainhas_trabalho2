        -:    0:Source:rainhas.cpp
        -:    1:/**
        -:    2:*@file rainhas.cpp
        -:    3:*/
        -:    4:
        -:    5:// Copyright (c) 2023, Thiago Fernandes
        -:    6:
        -:    7:
        -:    8:#include <iostream>
        -:    9:#include <fstream>
        -:   10:#include <string>
        -:   11:#include <vector>
        -:   12:#include <cctype>
        -:   13:#include "rainhas.hpp"
        -:   14:
        -:   15:using std::cout; using std::cin;
        -:   16:using std::endl; using std::string;
        -:   17:using std::vector;
        -:   18:
        -:   19:/**
        -:   20:* @brief Verifica tamanho da matriz inserida.
        -:   21:*
        -:   22:* Função verificaTamanho ira contar o numero de 0s e 1s no tabuleiro,
        -:   23:* caso haja mais ou menos de 64 pecas no tabuleiros, ela ira retornarm erro,
        -:   24:* bem como caso seja inserido um caractere diferente de "0" ou "1".
        -:   25:*
        -:   26:* @param filename nome do arquivo .txt que contem a matriz. 
        -:   27:* @return retorna 1 caso esteja tudo certo com a matiz,
        -:   28:*                 -1 caso seja um formato inválido
        -:   29:*                 -2 caso não seja possível abrir o arquivo.
        -:   30:*/
       15:   31:int verificaTamanho(const std::string& filename) {
       15:   32:    std::ifstream arquivo(filename);
        -:   33:
       15:   34:    if (!arquivo) {
    #####:   35:        std::cout << "Erro ao abrir o arquivo." << std::endl;
    #####:   36:        return -2;
        -:   37:    }
        -:   38:
       15:   39:    int contLetras = 0;
       15:   40:    int contNumeros = 0;
        -:   41:    char caractere;
        -:   42:
     1089:   43:    while (arquivo.get(caractere)) {
     1074:   44:        if (isalpha(caractere)) {
        6:   45:            contLetras++;
     1068:   46:        } else if (isdigit(caractere)) {
      934:   47:            contNumeros++;
        -:   48:        }
        -:   49:    }
        -:   50:
       15:   51:    if (contNumeros != 64 && contLetras != 0) {
        1:   52:        cout << "numeros de caracteres: " << contNumeros << endl;
        1:   53:        return -1;
        -:   54:    }
        -:   55:
       14:   56:    arquivo.close();
        -:   57:
       14:   58:    return 1;
       15:   59:}
        -:   60:
        -:   61:/**
        -:   62:* Checagem de possíveis ataques.
        -:   63:*
        -:   64:* Função check irá realizar a checagem de todos os possíveis ataques de uma
        -:   65:* rainha. percorrendo a matriz a procura de rainhas na mesma linha, coluna ou
        -:   66:* diagonais. 
        -:   67:*
        -:   68:* @param filename nome do arquivo .txt que contem o tabuleiro de xadrez. 
        -:   69:* @return retorna 1 caso a disposição das rainhas no tabuleiro satisfaça
        -:   70:*                  o problema;
        -:   71:*                 0 caso alguma rainha esteja em posição em que possa atacar
        -:   72:*                  outra. Neste caso, o programa irá criar um arquivo txt com o
        -:   73:*                  nome "ataque - 'nome do arquivo correspondente'", mostrando
        -:   74:*                  as posições em que ocorrem ataques de rainhas;
        -:   75:*                 -1 caso o tabuleiro do arquivo não seja uma matriz 8x8;
        -:   76:*                 -2 caso não seja possível abrir o arquivo.
        -:   77:*/
        8:   78:int check(const std::string& filename) {
        8:   79:    if (verificaTamanho(filename) == -1) { return -1;}
       7*:   80:    if (verificaTamanho(filename) == -2) { return -2;}
        -:   81:
        7:   82:    std::ifstream arquivo(filename);
        -:   83:
        7:   84:    std::string linha1, linha2, linha3, linha4, linha5, linha6, linha7, linha8;
        7:   85:    std::string linhaExtra;
        -:   86:
        7:   87:    if (std::getline(arquivo, linha1) &&
       14:   88:        std::getline(arquivo, linha2) &&
        7:   89:        std::getline(arquivo, linha3) &&
        7:   90:        std::getline(arquivo, linha4) &&
        7:   91:        std::getline(arquivo, linha5) &&
        7:   92:        std::getline(arquivo, linha6) &&
        7:   93:        std::getline(arquivo, linha7) &&
      21*:   94:        std::getline(arquivo, linha8) &&
        7:   95:        !std::getline(arquivo, linhaExtra)) {
        -:   96:    } else {
        -:   97:        std::cout <<
    #####:   98:        "O arquivo contém menos de 8 linhas ou possui mais do que 8 linhas." <<
    #####:   99:        std::endl;
    #####:  100:        return -1;
        -:  101:    }
        -:  102:
        7:  103:    arquivo.close();
        -:  104:
        7:  105:    int valueReturn = 1;
        -:  106:    int arrayLine1[8];  //  Array para armazenar os 8 primeiros números
        -:  107:    int arrayLine2[8];
        -:  108:    int arrayLine3[8];
        -:  109:    int arrayLine4[8];
        -:  110:    int arrayLine5[8];
        -:  111:    int arrayLine6[8];
        -:  112:    int arrayLine7[8];
        -:  113:    int arrayLine8[8];
        -:  114:
        -:  115:    // Extrai os 8 primeiros caracteres da string e os converte para inteiros
        7:  116:    int countLine = 0;
        7:  117:    int countTotal = 0;
        -:  118:    int* arrays[] = {
        -:  119:       arrayLine1, arrayLine2, arrayLine3, arrayLine4,
        7:  120:       arrayLine5, arrayLine6, arrayLine7, arrayLine8};
        -:  121:
        -:  122:    vector<string> linhas =
       70:  123:      { linha1, linha2, linha3, linha4, linha5, linha6, linha7, linha8};
        -:  124:
        7:  125:    int attackSameLine[8] = {10, 10, 10, 10, 10, 10, 10, 10};
        -:  126:
        7:  127:    std::string ataques = "";  //  Armazena ataques
        -:  128:
       62:  129:    for (int i = 0; i < 8; i++) {
        -:  130:        //  colocando lista em array de inteiros
       56:  131:        countLine = 0;
      504:  132:        for (int y = 0; y < 8; y++) {attackSameLine[y] = 10;}
        -:  133:
      503:  134:        for (int j = 0; j < 8; j++) {
      448:  135:            if (linhas[i][j] - '0' == 1 || linhas[i][j] - '0' == 0) {
      447:  136:                arrays[i][j] = linhas[i][j] - '0';
      447:  137:                if (arrays[i][j] == 1) {
       54:  138:                    countLine += 1;
       54:  139:                    countTotal += 1;
        -:  140:                }
        1:  141:            } else { return -1;}  //  caracter diferente de 1 e 0
        -:  142:        }
        -:  143:
        -:  144:        //  verificação ataque mesma linha
       55:  145:        if (countLine >=  2) {
        9:  146:            for (int x = 0; x < 8; x++) {
        8:  147:                if (arrays[i][x] == 1) {
       36:  148:                    for (int a = 0; a < 8; a++) {
       36:  149:                        if (attackSameLine[a] == 10) {
        8:  150:                            attackSameLine[a] = x;
        8:  151:                            break;
        -:  152:                        }
        -:  153:                    }
        -:  154:                }
        -:  155:            }
        8:  156:            for (int b = 0; b < 7; b++) {
        7:  157:                if (attackSameLine[b] != 10 && attackSameLine[b+1] != 10) {
        7:  158:                    ataques += std::to_string(i + 1); ataques += ",";
        7:  159:                    ataques += std::to_string(attackSameLine[b] + 1);
        7:  160:                    ataques += "            ";
        7:  161:                    ataques += std::to_string(i + 1); ataques += ",";
        7:  162:                    ataques += std::to_string(attackSameLine[b+1] + 1);
        7:  163:                    ataques += "\n";
        7:  164:                    valueReturn = 0;
        -:  165:                }
        -:  166:            }
        -:  167:        }
        -:  168:    }
        -:  169:
        6:  170:    if (countTotal > 8 || countTotal < 8) {  //  mais ou menos de 8 rainhas
    #####:  171:        std::cout << "matriz invalida" << std::endl;
    #####:  172:        return -1;
        -:  173:    }
        -:  174:
        -:  175:
        -:  176:    //  verificacao colunas
        6:  177:    bool shouldBreak = false;
       54:  178:    for (int i = 0; i < 8; i++) {
      432:  179:        for (int j = 0; j < 8; j++) {
      384:  180:            if (arrays[i][j] == 1) {
       48:  181:                shouldBreak =  false;
      272:  182:                for (int y = i; y < 8; y++) {
     1237:  183:                    for (int x = j; x < 8; x++) {
     1013:  184:                        if (arrays[y][x] == 1 && i != y && x == j) {
        5:  185:                            ataques += std::to_string(i + 1); ataques += ",";
        5:  186:                            ataques += std::to_string(j + 1);
        5:  187:                            ataques += "            ";
        5:  188:                            ataques += std::to_string(y + 1); ataques += ",";
        5:  189:                            ataques += std::to_string(x + 1); ataques += "\n";
        -:  190:
        5:  191:                            valueReturn = 0;
        5:  192:                            shouldBreak = true;
        5:  193:                            break;
        -:  194:                        }
        -:  195:                    }
      229:  196:                    if (shouldBreak) {break;}
        -:  197:                }
        -:  198:            }
        -:  199:        }
        -:  200:    }
        -:  201:
        -:  202:    //  verificacao diagonais direita
        6:  203:    int cont = 0;
       54:  204:    for (int i = 0; i < 8; i++) {
      432:  205:        for (int j = 0; j < 8; j++) {
      384:  206:            if (arrays[i][j] == 1) {
       48:  207:                cont = 1;
      128:  208:                for (int y = i + 1; y < 8; y++) {
      113:  209:                    if (j+cont >= 8) {
       22:  210:                        break;
        -:  211:                    }
       91:  212:                    if (arrays[y][j+cont] == 1) {
       11:  213:                        ataques += std::to_string(i + 1); ataques += ",";
       11:  214:                        ataques += std::to_string(j + 1);
       11:  215:                        ataques += "            ";
       11:  216:                        ataques += std::to_string(y + 1); ataques += ",";
       11:  217:                        ataques += std::to_string(j+cont + 1); ataques += "\n";
       11:  218:                        valueReturn = 0;
       11:  219:                        break;
        -:  220:                    }
       80:  221:                    cont += 1;
        -:  222:                }
        -:  223:            }
        -:  224:        }
        -:  225:    }
        -:  226:
        -:  227:    //  verificacao diagonais esquerda
        6:  228:    cont = 0;
       54:  229:    for (int i = 0; i < 8; i++) {
      432:  230:        for (int j = 0; j < 8; j++) {
      384:  231:            if (arrays[i][j] == 1) {
       48:  232:                cont = 1;
      153:  233:                for (int y = i + 1; y < 8; y++) {
      130:  234:                    if (j-cont < 0) {
       21:  235:                        break;
        -:  236:                    }
      109:  237:                    if (arrays[y][j-cont] == 1) {
        4:  238:                        ataques += std::to_string(i + 1); ataques += ",";
        4:  239:                        ataques += std::to_string(j + 1);
        4:  240:                        ataques += "            ";
        4:  241:                        ataques += std::to_string(y + 1); ataques += ",";
        4:  242:                        ataques += std::to_string(j-cont + 1); ataques += "\n";
        4:  243:                        valueReturn = 0;
        4:  244:                        break;
        -:  245:                    }
      105:  246:                    cont += 1;
        -:  247:                }
        -:  248:            }
        -:  249:        }
        -:  250:    }
        6:  251:    if (valueReturn == 0) {
        5:  252:        std::string nome = "ataques - ";
        5:  253:        nome += filename;
        5:  254:        std::ofstream arquivo(nome);
        -:  255:
        5:  256:        if (arquivo.is_open()) {  // Verifica se o arquivo foi aberto
        5:  257:            arquivo << ataques;  // Escreve a mensagem no arquivo
        5:  258:            arquivo.close();  // Fecha o arquivo
        -:  259:        } else {
    #####:  260:            std::cout << "Erro ao abrir o arquivo." << std::endl;
        -:  261:        }
        5:  262:    }
        6:  263:    return valueReturn;
        7:  264:}
        -:  265:/**
        -:  266:* Verifica o arquivo.
        -:  267:*
        -:  268:* Função verifica_solucao_8_rainhas é a função chamada pelo testa_rainhas.cpp
        -:  269:* que por sua vez chama as função de checagem na ordem certa para retornar a
        -:  270:* solução para o problema das 8 rainhas.
        -:  271:* @param filename nome do arquivo .txt que contem o tabuleiro de xadrez. 
        -:  272:* @return retorna 1 caso a disposição das rainhas no tabuleiro satisfaça
        -:  273:*                  o problema;
        -:  274:*                 0 caso alguma rainha esteja em posição em que possa atacar
        -:  275:*                  outra. Neste caso, o programa irá criar um arquivo txt com o
        -:  276:*                  nome "ataque - 'nome do arquivo correspondente'", mostrando
        -:  277:*                  as posições em que ocorrem ataques de rainhas;
        -:  278:*                 -1 caso o tabuleiro do arquivo não seja uma matriz 8x8;
        -:  279:*                 -2 caso não seja possível abrir o arquivo.
        -:  280:*/
        8:  281:int verifica_solucao_8_rainhas(const std::string& filename) {
        8:  282:    int valor = check(filename);
        -:  283:
        8:  284:    if (valor == -1) {
        2:  285:        return -1;  //  matriz Inválida
        -:  286:    }
        6:  287:    if (valor == -2) {
    #####:  288:        cout << "Erro ao abrir arquivo" << endl;
        -:  289:    }
        6:  290:    if (valor == 0) {  //  Problema que nao e solução
        5:  291:        return 0;
        -:  292:    }
        1:  293:    if (valor == 1) {  //  problema que satisfaz as 8 rainhas
        1:  294:        return 1;
        -:  295:    }
        -:  296:
    #####:  297:    return -1;
        -:  298:}
